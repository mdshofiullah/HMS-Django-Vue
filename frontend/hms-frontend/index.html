<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hospital Management System</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
      }

      :root {
        --primary: #1a75bc;
        --primary-dark: #0a4299;
        --secondary: #2c3e50;
        --accent: #3498db;
        --light: #f5f7fa;
        --dark: #2c3e50;
        --success: #2ecc71;
        --warning: #f39c12;
        --danger: #e74c3c;
        --gray: #95a5a6;
        --white: #ffffff;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        width: 100%;
        max-width: 1400px;
        background: var(--white);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 90vh;
      }

      .app-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: var(--white);
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .app-title {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .app-title i {
        font-size: 28px;
      }

      .app-title h1 {
        font-size: 24px;
        font-weight: 600;
      }

      .app-content {
        display: flex;
        flex: 1;
      }

      .sidebar {
        width: 250px;
        background: var(--secondary);
        color: var(--white);
        padding: 20px 0;
      }

      .sidebar-menu {
        list-style: none;
      }

      .sidebar-menu li {
        padding: 15px 25px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .sidebar-menu li:hover,
      .sidebar-menu li.active {
        background: #34495e;
        border-left: 4px solid var(--accent);
      }

      .sidebar-menu li i {
        width: 20px;
        text-align: center;
      }

      .main-content {
        flex: 1;
        padding: 25px;
        background: var(--light);
        overflow-y: auto;
      }

      .auth-container {
        display: flex;
        height: 100%;
      }

      .auth-left {
        flex: 1;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: var(--white);
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .auth-left h2 {
        font-size: 32px;
        margin-bottom: 20px;
      }

      .auth-left p {
        font-size: 18px;
        line-height: 1.6;
      }

      .auth-features {
        margin-top: 30px;
      }

      .auth-feature {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      .auth-feature i {
        font-size: 20px;
        background: rgba(255, 255, 255, 0.2);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .auth-right {
        flex: 1;
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .auth-form {
        max-width: 400px;
        width: 100%;
        margin: 0 auto;
      }

      .auth-form h2 {
        color: var(--dark);
        margin-bottom: 30px;
        text-align: center;
        font-size: 28px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--dark);
        font-weight: 500;
      }

      .form-group input {
        width: 100%;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border 0.3s;
      }

      .form-group input:focus {
        border-color: var(--accent);
        outline: none;
      }

      .btn {
        padding: 15px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary {
        background: var(--accent);
        color: var(--white);
      }

      .btn-primary:hover {
        background: #2980b9;
      }

      .btn-block {
        width: 100%;
      }

      .auth-switch {
        text-align: center;
        margin-top: 20px;
        color: var(--gray);
      }

      .auth-switch a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
      }

      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: var(--white);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        text-align: center;
        transition: transform 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card i {
        font-size: 36px;
        color: var(--accent);
        margin-bottom: 15px;
      }

      .card h3 {
        font-size: 18px;
        color: var(--dark);
        margin-bottom: 10px;
      }

      .card p {
        font-size: 24px;
        font-weight: 600;
        color: var(--accent);
      }

      .module-content {
        background: var(--white);
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .module-content h2 {
        color: var(--dark);
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .alert-error {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ef9a9a;
      }

      .alert-success {
        background: #e8f5e9;
        color: #2e7d32;
        border: 1px solid #a5d6a7;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: var(--white);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: var(--dark);
      }

      tr:hover {
        background-color: #f5f7fa;
      }

      .user-welcome {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-right: 20px;
        color: var(--white);
      }

      .user-welcome img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.5);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .content-placeholder {
        text-align: center;
        padding: 40px;
        color: var(--gray);
      }

      .content-placeholder i {
        font-size: 64px;
        margin-bottom: 20px;
        color: #bdc3c7;
      }

      .content-placeholder p {
        font-size: 18px;
        line-height: 1.6;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn-sm {
        padding: 8px 12px;
        font-size: 14px;
      }

      .btn-success {
        background: var(--success);
        color: var(--white);
      }

      .btn-warning {
        background: var(--warning);
        color: var(--white);
      }

      .btn-danger {
        background: var(--danger);
        color: var(--white);
      }

      .search-bar {
        display: flex;
        margin-bottom: 20px;
        gap: 10px;
      }

      .search-bar input {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
      }

      .filter-options {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .filter-options select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: var(--white);
      }

      .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-active {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .status-inactive {
        background: #ffebee;
        color: #c62828;
      }

      .status-pending {
        background: #fff3e0;
        color: #ef6c00;
      }

      .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
        gap: 5px;
      }

      .pagination button {
        padding: 8px 12px;
        border: 1px solid #ddd;
        background: var(--white);
        border-radius: 5px;
        cursor: pointer;
      }

      .pagination button.active {
        background: var(--accent);
        color: var(--white);
        border-color: var(--accent);
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal {
        background: var(--white);
        border-radius: 10px;
        padding: 25px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray);
      }

      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }

      .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <script>
      const { createApp, ref, computed, onMounted, reactive } = Vue

      // API Service
      const apiService = {
        baseURL: 'http://localhost:8000/api',

        // central request helper: sets Authorization header automatically when token is present
        async request(endpoint, options = {}) {
          const url = `${this.baseURL}${endpoint}`
          const token = localStorage.getItem('access_token')
          const headers = {
            'Content-Type': 'application/json',
            ...(options.headers || {}),
          }
          if (token) headers.Authorization = `Bearer ${token}`

          const config = {
            url,
            method: options.method || 'GET',
            headers,
            data: options.data || undefined,
            params: options.params || undefined,
            withCredentials: true,
          }

          try {
            const response = await axios(config)
            return response.data
          } catch (error) {
            // Propagate axios error so callers can inspect response
            throw error
          }
        },

        // Auth endpoints â€” use token/profile/register paths that match backend
        async login(credentials) {
          // Use the JWT token endpoint used by SimpleJWT or your core.urls
          // Change '/token/' to '/login/' if your backend defines a custom LoginView at /api/login/
          return this.request('/token/', {
            method: 'POST',
            data: credentials,
          })
        },

        async register(userData) {
          // Ensure this matches backend route (core.urls: path('register/', ...))
          return this.request('/register/', {
            method: 'POST',
            data: userData,
          })
        },

        async logout() {
          return this.request('/logout/', {
            method: 'POST',
          })
        },

        // Data endpoints
        async getUsers() {
          return this.request('/users/')
        },

        async getDepartments() {
          return this.request('/departments/')
        },

        async getDoctors() {
          return this.request('/doctors/')
        },

        async getPatients() {
          return this.request('/patients/')
        },

        async getAppointments() {
          return this.request('/appointments/')
        },

        async getPrescriptions() {
          return this.request('/prescriptions/')
        },

        async getLabTests() {
          return this.request('/lab-tests/')
        },

        async getBilling() {
          return this.request('/billing/')
        },

        async getReports() {
          return this.request('/reports/')
        },
      }

      // Auth Composable
      const useAuth = () => {
        const user = ref(null)
        const isAuthenticated = ref(false)

        const login = async (credentials) => {
          try {
            const response = await apiService.login(credentials)
            user.value = response.user
            isAuthenticated.value = true
            localStorage.setItem('hms-user', JSON.stringify(response.user))
            localStorage.setItem('hms-token', response.token)
            return { success: true }
          } catch (error) {
            return {
              success: false,
              error: error.response?.data?.message || 'Login failed',
            }
          }
        }

        const register = async (userData) => {
          try {
            const response = await apiService.register(userData)
            return { success: true, message: response.message }
          } catch (error) {
            return {
              success: false,
              error: error.response?.data?.message || 'Registration failed',
            }
          }
        }

        const logout = async () => {
          try {
            await apiService.logout()
          } catch (error) {
            console.error('Logout error:', error)
          } finally {
            user.value = null
            isAuthenticated.value = false
            localStorage.removeItem('hms-user')
            localStorage.removeItem('hms-token')
          }
        }

        // Check if user is logged in on app start
        onMounted(() => {
          const savedUser = localStorage.getItem('hms-user')
          const token = localStorage.getItem('hms-token')

          if (savedUser && token) {
            user.value = JSON.parse(savedUser)
            isAuthenticated.value = true
          }
        })

        return {
          user,
          isAuthenticated,
          login,
          register,
          logout,
        }
      }

      // Login Component
      const LoginForm = {
        props: ['error', 'success'],
        emits: ['login', 'switch-to-register'],
        setup(props, { emit }) {
          const username = ref('')
          const password = ref('')

          const login = () => {
            emit('login', {
              username: username.value,
              password: password.value,
            })
          }

          return {
            username,
            password,
            login,
          }
        },
        template: `
                <div class="auth-form">
                    <h2>Login to HMS</h2>
                    
                    <div v-if="error" class="alert alert-error">
                        <i class="fas fa-exclamation-circle"></i> {{ error }}
                    </div>
                    
                    <div v-if="success" class="alert alert-success">
                        <i class="fas fa-check-circle"></i> {{ success }}
                    </div>
                    
                    <form @submit.prevent="login">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" id="username" v-model="username" placeholder="Enter your username" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" v-model="password" placeholder="Enter your password" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">
                            Login
                        </button>
                    </form>
                    
                    <div class="auth-switch">
                        Don't have an account? <a href="#" @click.prevent="$emit('switch-to-register')">Register here</a>
                    </div>
                </div>
            `,
      }

      // Register Component
      const RegisterForm = {
        emits: ['register', 'switch-to-login'],
        setup(props, { emit }) {
          const username = ref('')
          const email = ref('')
          const password = ref('')
          const confirmPassword = ref('')
          const error = ref('')

          const register = () => {
            error.value = ''

            if (password.value !== confirmPassword.value) {
              error.value = 'Passwords do not match'
              return
            }

            if (password.value.length < 6) {
              error.value = 'Password must be at least 6 characters'
              return
            }

            emit('register', {
              username: username.value,
              email: email.value,
              password: password.value,
            })
          }

          return {
            username,
            email,
            password,
            confirmPassword,
            error,
            register,
          }
        },
        template: `
                <div class="auth-form">
                    <h2>Create Account</h2>
                    
                    <div v-if="error" class="alert alert-error">
                        <i class="fas fa-exclamation-circle"></i> {{ error }}
                    </div>
                    
                    <form @submit.prevent="register">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" id="username" v-model="username" placeholder="Enter your username" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" v-model="email" placeholder="Enter your email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" v-model="password" placeholder="Enter your password" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" v-model="confirmPassword" placeholder="Confirm your password" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">
                            Register
                        </button>
                    </form>
                    
                    <div class="auth-switch">
                        Already have an account? <a href="#" @click.prevent="$emit('switch-to-login')">Login here</a>
                    </div>
                </div>
            `,
      }

      // Dashboard Component
      const Dashboard = {
        setup() {
          const stats = ref({
            patients: 0,
            doctors: 0,
            appointments: 0,
            labTests: 0,
          })

          const loading = ref(true)

          const fetchStats = async () => {
            try {
              // In a real app, you would have an endpoint for stats
              const [patientsRes, doctorsRes, appointmentsRes, labTestsRes] =
                await Promise.allSettled([
                  apiService.getPatients(),
                  apiService.getDoctors(),
                  apiService.getAppointments(),
                  apiService.getLabTests(),
                ])

              stats.value.patients =
                patientsRes.status === 'fulfilled' ? patientsRes.value.length : 0
              stats.value.doctors = doctorsRes.status === 'fulfilled' ? doctorsRes.value.length : 0
              stats.value.appointments =
                appointmentsRes.status === 'fulfilled' ? appointmentsRes.value.length : 0
              stats.value.labTests =
                labTestsRes.status === 'fulfilled' ? labTestsRes.value.length : 0
            } catch (error) {
              console.error('Error fetching stats:', error)
            } finally {
              loading.value = false
            }
          }

          onMounted(() => {
            fetchStats()
          })

          return {
            stats,
            loading,
          }
        },
        template: `
                <div>
                    <h1>Welcome to HMS Dashboard</h1>
                    <p>Select a module from the sidebar to manage hospital operations.</p>
                    
                    <div v-if="loading" class="content-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading dashboard data...</p>
                    </div>
                    
                    <div v-else class="dashboard-cards">
                        <div class="card">
                            <i class="fas fa-users"></i>
                            <h3>Total Patients</h3>
                            <p>{{ stats.patients }}</p>
                        </div>
                        <div class="card">
                            <i class="fas fa-user-md"></i>
                            <h3>Total Doctors</h3>
                            <p>{{ stats.doctors }}</p>
                        </div>
                        <div class="card">
                            <i class="fas fa-calendar-check"></i>
                            <h3>Today's Appointments</h3>
                            <p>{{ stats.appointments }}</p>
                        </div>
                        <div class="card">
                            <i class="fas fa-flask"></i>
                            <h3>Pending Lab Tests</h3>
                            <p>{{ stats.labTests }}</p>
                        </div>
                    </div>
                </div>
            `,
      }

      // User Management Component
      const UserManagement = {
        setup() {
          const users = ref([])
          const loading = ref(true)
          const searchQuery = ref('')
          const currentPage = ref(1)
          const itemsPerPage = 10
          const showModal = ref(false)
          const editingUser = ref(null)

          const fetchUsers = async () => {
            try {
              const data = await apiService.getUsers()
              users.value = data
            } catch (error) {
              console.error('Error fetching users:', error)
            } finally {
              loading.value = false
            }
          }

          const filteredUsers = computed(() => {
            if (!searchQuery.value) return users.value

            return users.value.filter(
              (user) =>
                user.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                user.email.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                user.role.toLowerCase().includes(searchQuery.value.toLowerCase()),
            )
          })

          const paginatedUsers = computed(() => {
            const start = (currentPage.value - 1) * itemsPerPage
            const end = start + itemsPerPage
            return filteredUsers.value.slice(start, end)
          })

          const totalPages = computed(() => {
            return Math.ceil(filteredUsers.value.length / itemsPerPage)
          })

          const editUser = (user) => {
            editingUser.value = { ...user }
            showModal.value = true
          }

          const saveUser = async () => {
            // In a real app, you would call an API to save the user
            console.log('Saving user:', editingUser.value)
            showModal.value = false
            editingUser.value = null
          }

          const deleteUser = (user) => {
            if (confirm(`Are you sure you want to delete ${user.name}?`)) {
              // In a real app, you would call an API to delete the user
              users.value = users.value.filter((u) => u.id !== user.id)
            }
          }

          onMounted(() => {
            fetchUsers()
          })

          return {
            users: paginatedUsers,
            loading,
            searchQuery,
            currentPage,
            totalPages,
            showModal,
            editingUser,
            editUser,
            saveUser,
            deleteUser,
            filteredUsers,
          }
        },
        template: `
                <div class="module-content">
                    <h2><i class="fas fa-users"></i> User Management</h2>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add User
                        </button>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" v-model="searchQuery" placeholder="Search users...">
                        <button class="btn btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <div v-if="loading" class="content-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading users...</p>
                    </div>
                    
                    <div v-else>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="user in users" :key="user.id">
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.name }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.role }}</td>
                                    <td>
                                        <span class="status-badge" :class="{
                                            'status-active': user.status === 'Active',
                                            'status-inactive': user.status === 'Inactive'
                                        }">
                                            {{ user.status }}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-warning" @click="editUser(user)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" @click="deleteUser(user)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="pagination" v-if="totalPages > 1">
                            <button 
                                v-for="page in totalPages" 
                                :key="page" 
                                @click="currentPage = page"
                                :class="{ active: currentPage === page }"
                            >
                                {{ page }}
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-overlay" v-if="showModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3>Edit User</h3>
                                <button class="modal-close" @click="showModal = false">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Name</label>
                                    <input type="text" v-model="editingUser.name">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" v-model="editingUser.email">
                                </div>
                                <div class="form-group">
                                    <label>Role</label>
                                    <select v-model="editingUser.role">
                                        <option value="Admin">Admin</option>
                                        <option value="Doctor">Doctor</option>
                                        <option value="Nurse">Nurse</option>
                                        <option value="Staff">Staff</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select v-model="editingUser.status">
                                        <option value="Active">Active</option>
                                        <option value="Inactive">Inactive</option>
                                    </select>
                                </div>
                                <div class="action-buttons">
                                    <button class="btn btn-primary" @click="saveUser">Save</button>
                                    <button class="btn" @click="showModal = false">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
      }

      // Department Management Component
      const DepartmentManagement = {
        setup() {
          const departments = ref([])
          const loading = ref(true)

          const fetchDepartments = async () => {
            try {
              const data = await apiService.getDepartments()
              departments.value = data
            } catch (error) {
              console.error('Error fetching departments:', error)
            } finally {
              loading.value = false
            }
          }

          onMounted(() => {
            fetchDepartments()
          })

          return {
            departments,
            loading,
          }
        },
        template: `
                <div class="module-content">
                    <h2><i class="fas fa-building"></i> Department Management</h2>
                    
                    <div v-if="loading" class="content-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading departments...</p>
                    </div>
                    
                    <div v-else>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Department Name</th>
                                    <th>Head of Department</th>
                                    <th>Staff Count</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="dept in departments" :key="dept.id">
                                    <td>{{ dept.id }}</td>
                                    <td>{{ dept.name }}</td>
                                    <td>{{ dept.head }}</td>
                                    <td>{{ dept.staff }}</td>
                                    <td>
                                        <span class="status-badge status-active">
                                            Active
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
      }

      // Root Component
      const App = {
        components: {
          LoginForm,
          RegisterForm,
          Dashboard,
          UserManagement,
          DepartmentManagement,
        },
        setup() {
          const {
            user,
            isAuthenticated,
            login: authLogin,
            register: authRegister,
            logout,
          } = useAuth()

          const currentView = ref('login')
          const authError = ref('')
          const authSuccess = ref('')
          const activeSection = ref('dashboard')
          const loading = ref(false)

          const login = async (credentials) => {
            authError.value = ''
            loading.value = true

            const result = await authLogin(credentials)

            if (result.success) {
              authSuccess.value = 'Login successful!'
              activeSection.value = 'dashboard'
            } else {
              authError.value = result.error
            }

            loading.value = false
          }

          const register = async (userData) => {
            authError.value = ''
            loading.value = true

            const result = await authRegister(userData)

            if (result.success) {
              authSuccess.value = result.message
              currentView.value = 'login'
            } else {
              authError.value = result.error
            }

            loading.value = false
          }

          const doLogout = async () => {
            await logout()
            currentView.value = 'login'
            authError.value = ''
            authSuccess.value = ''
          }

          const switchAuthView = (view) => {
            currentView.value = view
            authError.value = ''
            authSuccess.value = ''
          }

          return {
            currentView,
            isAuthenticated,
            user,
            authError,
            authSuccess,
            activeSection,
            loading,
            login,
            register,
            doLogout,
            switchAuthView,
          }
        },
        template: `
                <div class="container">
                    <template v-if="isAuthenticated">
                        <header class="app-header">
                            <div class="app-title">
                                <i class="fas fa-hospital"></i>
                                <h1>Hospital Management System</h1>
                            </div>
                            <div class="header-actions">
                                <div class="user-welcome">
                                    <i class="fas fa-user-circle"></i>
                                    <span>Welcome, {{ user?.name || user?.username }}</span>
                                </div>
                                <button @click="doLogout" class="btn btn-primary">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                        </header>
                        <div class="app-content">
                            <nav class="sidebar">
                                <ul class="sidebar-menu">
                                    <li :class="{ active: activeSection === 'dashboard' }" @click="activeSection = 'dashboard'">
                                        <i class="fas fa-home"></i> Dashboard
                                    </li>
                                    <li :class="{ active: activeSection === 'users' }" @click="activeSection = 'users'">
                                        <i class="fas fa-users"></i> User Management
                                    </li>
                                    <li :class="{ active: activeSection === 'departments' }" @click="activeSection = 'departments'">
                                        <i class="fas fa-building"></i> Department Management
                                    </li>
                                    <li :class="{ active: activeSection === 'doctors' }" @click="activeSection = 'doctors'">
                                        <i class="fas fa-user-md"></i> Doctor Management
                                    </li>
                                    <li :class="{ active: activeSection === 'patients' }" @click="activeSection = 'patients'">
                                        <i class="fas fa-procedures"></i> Patient Management
                                    </li>
                                    <li :class="{ active: activeSection === 'appointments' }" @click="activeSection = 'appointments'">
                                        <i class="fas fa-calendar-check"></i> Appointment Management
                                    </li>
                                    <li :class="{ active: activeSection === 'prescriptions' }" @click="activeSection = 'prescriptions'">
                                        <i class="fas fa-prescription"></i> Prescription Management
                                    </li>
                                    <li :class="{ active: activeSection === 'lab-tests' }" @click="activeSection = 'lab-tests'">
                                        <i class="fas fa-flask"></i> Lab Test Management
                                    </li>
                                    <li :class="{ active: activeSection === 'billing' }" @click="activeSection = 'billing'">
                                        <i class="fas fa-file-invoice-dollar"></i> Billing Management
                                    </li>
                                    <li :class="{ active: activeSection === 'reports' }" @click="activeSection = 'reports'">
                                        <i class="fas fa-chart-bar"></i> Report Management
                                    </li>
                                </ul>
                            </nav>
                            <main class="main-content">
                                <div v-if="activeSection === 'dashboard'">
                                    <Dashboard />
                                </div>
                                <div v-else-if="activeSection === 'users'">
                                    <UserManagement />
                                </div>
                                <div v-else-if="activeSection === 'departments'">
                                    <DepartmentManagement />
                                </div>
                                <div v-else>
                                    <div class="module-content">
                                        <h2>
                                            <i class="fas" :class="{
                                                'fa-user-md': activeSection === 'doctors',
                                                'fa-procedures': activeSection === 'patients',
                                                'fa-calendar-check': activeSection === 'appointments',
                                                'fa-prescription': activeSection === 'prescriptions',
                                                'fa-flask': activeSection === 'lab-tests',
                                                'fa-file-invoice-dollar': activeSection === 'billing',
                                                'fa-chart-bar': activeSection === 'reports'
                                            }"></i>
                                            {{ activeSection.charAt(0).toUpperCase() + activeSection.slice(1).replace('-', ' ') }}
                                        </h2>
                                        <div class="content-placeholder">
                                            <i class="fas fa-cogs"></i>
                                            <p>This module is under development. Check back soon!</p>
                                        </div>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </template>
                    
                    <template v-else>
                        <div class="auth-container">
                            <div class="auth-left">
                                <h2>Hospital Management System</h2>
                                <p>Comprehensive solution for managing hospital operations, patient records, appointments, and billing.</p>
                                
                                <div class="auth-features">
                                    <div class="auth-feature">
                                        <i class="fas fa-user-injured"></i>
                                        <div>Patient Management</div>
                                    </div>
                                    <div class="auth-feature">
                                        <i class="fas fa-calendar-alt"></i>
                                        <div>Appointment Scheduling</div>
                                    </div>
                                    <div class="auth-feature">
                                        <i class="fas fa-file-medical"></i>
                                        <div>Electronic Health Records</div>
                                    </div>
                                    <div class="auth-feature">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <div>Billing & Invoicing</div>
                                    </div>
                                </div>
                            </div>
                            <div class="auth-right">
                                <LoginForm 
                                    v-if="currentView === 'login'" 
                                    :error="authError" 
                                    :success="authSuccess"
                                    @login="login"
                                    @switch-to-register="switchAuthView('register')"
                                />
                                <RegisterForm 
                                    v-else 
                                    @register="register"
                                    @switch-to-login="switchAuthView('login')"
                                />
                            </div>
                        </div>
                    </template>
                </div>
            `,
      }

      // Mount the app
      const application = createApp(App)
      application.mount('#app')
    </script>
  </body>
</html>
